<?xml version="1.0" encoding="utf-8"?>
<component name="StationSelectorPanel" extends="Panel" initialFocus="exampleRowList">

	<script type="text/brightscript" uri="pkg:/components/StationSelectorPanel.brs" />
	<script type="text/brightscript" uri="pkg:/components/search.brs" />
	<script type="text/brightscript" uri="pkg:/components/StationActions.brs" />

	<interface>
	</interface>

	<script type="text/brightscript">
		<![CDATA[
		sub init()
			m.top.panelSize = "full"
			m.top.leftPosition = 0
			m.top.isFullScreen = true
			m.top.overhangTitle = "The Bat Player"
			m.top.focusable = true
			m.content = createObject("roSGNode", "ContentNode")

			m.rowlist = m.top.findNode("StationsRowList")
			m.rowlist.ObserveField("rowItemFocused", "rowItemFocused")
			m.rowlist.ObserveField("rowItemSelected", "rowItemSelected")
			m.rowlist.content = m.content

		    m.top.observeField("focusedChild", "focusChanged")

	    	m.rowlist.SetFocus(true)
			m.currentRow = 0
			m.currentItem = 0

		    audio = createObject("roSGNode", "Audio")
			m.global.audio = audio

			setupStations()
		end sub

		sub setupDirectoryButtons()
			buttons = createObject("roSGNode", "ContentNode")
			buttons.title = "More Stations"

			browseButton = createObject("roSGNode", "ContentNode")
			browseButton.title = "Browse"

			searchButton = createObject("roSGNode", "ContentNode")
			searchButton.title = "Search"

			featuredStationsButton = createObject("roSGNode", "ContentNode")
			featuredStationsButton.title = "Featured"

			buttons.appendChild(browseButton)
			buttons.appendChild(searchButton)
			buttons.appendChild(featuredStationsButton)

			m.rowlist.content.insertChild(buttons, 3)
		end sub

		sub rowItemSelected(item)
			print "rowItemSelected"

			currentItemLocation = item.getData()
			currentRow = currentItemLocation[0]
			currentItem = currentItemLocation[1]

			if currentRow = 3
				if currentItem = 0
					navigateToSearch()
				else if currentItem = 1
					navigateToBrowse()
				else if currentItem = 2
					navigateToFeaturedStations()
				end if
				return
			end if

			rowData = m.rowlist.content.getChild(currentRow)
			if rowData = invalid
				return
			end if

			station = rowData.getChild(currentItem)

			if currentRow = 0
				PlayStation(station)
			else
				showStationPlayDialog(station)
			end if
			
		end sub

		sub showStationPlayDialog(station)
			stationDetails = createObject("roSGNode", "StationDetailPanel")
			stationDetails.station = station
			m.top.getParent().getParent().getParent().panelSet.appendChild(stationDetails)
		end sub

		sub rowItemFocused(item)
			index = item.getData()
			m.currentRow = index[0]
			m.currentItem = index[1]

			focusedCell = item.getData()
			cell = item.getRoSGNode()
			'if cell <> invalid
			'	cell.itemlabel.text = index[0].ToStr()
			'end if
		end sub

		function focusChanged()
			print "focusChanged()"
			'if m.top.isInFocusChain()
				m.rowlist.setFocus(true)
			'end if
		end function

		]]>
	</script>
	<children>
		
		<Poster
			id="headerPoster"
			uri="pkg:/images/StationSelectionBackgroundTexture.png"
			width="1280" height="720"
			translation="[0,0]"
			opacity="0.75"
		/>

		<RowList
			id="StationsRowList"
			translation="[ 40, 30 ]"
			itemComponentName="StationSelectorRowListItem"
			numRows="5"
			itemSize="[ 1180, 350 ]"
			rowItemSize="[ [290, 290] ]"
			itemSpacing="[ 0, 20 ]"
			showRowLabel="[ true ]"
			drawFocusFeedback="true" 
			vertFocusAnimationStyle="fixedFocusWrap"
			rowFocusAnimationStyle="floatingFocus" 
			/>
			
	</children>
</component>