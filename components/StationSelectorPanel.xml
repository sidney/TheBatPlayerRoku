<?xml version="1.0" encoding="utf-8"?>
<component name="StationSelectorPanel" extends="Panel" initialFocus="exampleRowList">

	<script type="text/brightscript" uri="pkg:/components/StationSelectorPanel.brs" />
	<script type="text/brightscript" uri="pkg:/components/search.brs" />

	<interface>
	</interface>

	<script type="text/brightscript">
		<![CDATA[
		sub init()
			m.top.panelSize = "full"
			m.top.leftPosition = 0

			m.content = createObject("roSGNode", "ContentNode")

			m.rowlist = m.top.findNode("StationsRowList")
			m.rowlist.ObserveField("rowItemFocused", "rowItemFocused")
			m.rowlist.ObserveField("rowItemSelected", "rowItemSelected")
			m.rowlist.content = m.content

	    	m.rowlist.SetFocus(true)
			m.currentRow = 0
			m.currentItem = 0

		    audio = createObject("roSGNode", "Audio")
			m.global.audio = audio

			setupStations()
		end sub

		sub setupDirectoryButtons()
			buttons = createObject("roSGNode", "ContentNode")
			buttons.title = "More Stations"

			browseButton = createObject("roSGNode", "ContentNode")
			browseButton.title = "Browse"

			searchButton = createObject("roSGNode", "ContentNode")
			searchButton.title = "Search"

			buttons.appendChild(browseButton)
			buttons.appendChild(searchButton)

			m.rowlist.content.insertChild(buttons, 3)
		end sub

		sub rowItemSelected(item)
			print "rowItemSelected"

			currentItemLocation = item.getData()
			currentRow = currentItemLocation[0]
			currentItem = currentItemLocation[1]

			if currentRow = 3
				if currentItem = 0
					navigateToSearch()
				else if currentItem = 1
					navigateToBrowse()
				end if
				return
			end if

			rowData = m.rowlist.content.getChild(currentRow)
			if rowData = invalid
				return
			end if

			station = rowData.getChild(currentItem)
			headers = createObject("roArray", 2, true)
			headers.push("Icy-MetaData:0")
			headers.push("User-Agent:The Bat Player/Roku")
			station.HttpHeaders = headers

			m.global.audio.content = station
			m.global.audio.control = "play"

			showNowPlayingScreen(station)
		end sub

		sub rowItemFocused(item)
			index = item.getData()
			m.currentRow = index[0]
			m.currentItem = index[1]

			focusedCell = item.getData()
			cell = item.getRoSGNode()
			'if cell <> invalid
			'	cell.itemlabel.text = index[0].ToStr()
			'end if
		end sub

		sub showNowPlayingScreen(station)
			m.global.station = station
		end sub

		]]>
	</script>
	<children>
		
		<Poster
			id="headerPoster"
			uri="pkg:/images/StationSelectionBackgroundTexture.png"
			width="1280" height="720"
			translation="[0,0]"
			opacity="0.75"
		/>

		<RowList
			id="StationsRowList"
			translation="[ 40, 30 ]"
			itemComponentName="StationSelectorRowListItem"
			numRows="5"
			itemSize="[ 1180, 350 ]"
			rowItemSize="[ [290, 290] ]"
			itemSpacing="[ 0, 20 ]"
			showRowLabel="[ true ]"
			drawFocusFeedback="true" 
			vertFocusAnimationStyle="fixedFocusWrap"
			rowFocusAnimationStyle="floatingFocus" 
			/>
			
	</children>
</component>