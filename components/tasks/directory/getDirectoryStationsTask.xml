<?xml version="1.0" encoding="utf-8" ?>
  
<component name = "GetDirectoryStationsTask" extends = "Task" >
 	<script type="text/brightscript" uri="pkg:/source/DataUtils.brs" />
  <script type="text/brightscript" uri="pkg:/source/utils.brs" />
  <script type="text/brightscript" uri="pkg:/source/Downloads.brs" />
  <script type="text/brightscript" uri="pkg:/source/Session.brs" />
  <script type="text/brightscript" uri="pkg:/source/EventLoop.brs" />
	<script type="text/brightscript" uri="pkg:/source/roku-lib/RokuLib/util/GeneralUtils.brs" />
	<script type="text/brightscript" uri="pkg:/components/tasks/directory/getDirectoryStationsTask.brs" />

  <interface>
    <field id = "stations" type = "node" />
    <field id = "title" type = "string" />
    <field id = "url" type = "url" />
  </interface>
 
  <script type = "text/brightscript" >
    <![CDATA[
 
    sub init()
      m.top.functionName = "taskGetStations"
    end sub
 
    sub taskGetStations()
      print "taskGetStations()"
      stationsContentNode = createObject("RoSGNode","ContentNode")
      stationsContentNode.title = m.top.title

      stations = GetStationsAtUrl(m.top.url)

      for each station in stations 
        item = createObject("roSGNode", "SingleStationContentNode")
        item.name = station.name
        item.image = station.image
        item.url = station.stream
        item.streamformat = station.format
        stationsContentNode.appendChild(item)
      end for
 
      m.top.stations = stationsContentNode
    end sub
 
    ]]>
  </script>
 
</component>