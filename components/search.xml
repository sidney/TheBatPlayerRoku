<?xml version="1.0" encoding="utf-8"?>
<component name="SearchResultsPanel" extends="Group" initialFocus="stationlist">

 <interface> 
    <field id = "stations" type = "node" onChange = "setsearchresults"/>
</interface>

<script type="text/brightscript" uri="pkg:/source/config.brs" />

<script type = "text/brightscript" >
    <![CDATA[

    sub init()
        m.list = m.top.findNode("stationlist")
        
        m.list.observefield("itemFocused", "itemFocused")
        m.list.observefield("itemSelected", "itemSelected")

        m.list.setFocus(true)
        m.top.observefield("stations", "showsearchresults")
        
        m.stationimage = m.top.findNode("stationimage")
    end sub

    sub showsearchresults()
        m.list.content = m.top.stations
    end sub

    sub itemFocused(event)
        if m.top.stations = invalid
            return
        end if

        index = event.getData()
        item = m.top.stations.getChild(index)
        m.stationimage.uri = item.image
    end sub

    sub itemSelected(event)
        index = event.getData()
        station = m.top.stations.getChild(index)

        m.childScreen = m.top.createChild("StationDetailPanel")
        m.childScreen.station = station
        m.childScreen.setFocus(true)
    end sub

    function onKeyEvent(key as String, press as Boolean) as Boolean

        if NOT press
            return true
        end if

        handled = false

        if key = "back"
            print "Search#onKeyEvent"

            if m.childScreen <> invalid
                m.top.removeChild(m.childScreen)
                m.childScreen = invalid
                m.list.setFocus(true)
                handled = true
            end if
        end if

        return handled
    end function
    ]]>

  </script>

<children>

    <Poster
        id="headerPoster"
        uri="pkg:/images/StationSelectionBackgroundTexture.png"
        width="1280" height="720"
        translation="[0,0]"
        opacity="1.0"/>

    <LabelList
    id = "stationlist"
    translation = "[160,92]"
    itemSize = "[1000,48]"/>

    <Poster 
      id = "stationimage"
      translation = "[ 600, 20 ]" 
      width = "400" 
      height = "400" />
</children>

</component>